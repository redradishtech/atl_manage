#!/bin/bash -eu

echo "-- Generated by $0 at $(date)"
cat "$ATL_MANAGE/lib/pg_simpleinserts/simpleinserts_prelude.plpgsql"
{
	echo '\timing off'
	"$ATL_MANAGE/lib/pg_simpleinserts/jira_print_sequencevalue_table_mappings.sql.sh"
} | atl_psql -tAq | grep -v Time: | while IFS=\| read -r seq table key; do
	echo "insert into primarykeyinfo values ('$table', '$key', '$seq');"
	echo "alter table $table ALTER $key SET DEFAULT nextid('$table');"
done
