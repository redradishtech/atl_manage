#!/bin/bash -eu
set -o pipefail
## Assuming an app has been deployed (atl_deploy), 'deactivate' it by:
##
## - unsymlinking its systemd service definition to the right place, and reloading systemd
## - unsymlinking its webserver config file to the right place, and reloading the webserver
## - removing cron entries for backups, replication, backup mirrors, monitoring checks, log cleanup scripts, etc
## - removing nagios/icinga monitors for the above

# shellcheck source=/opt/atl_manage/lib/common.sh
source "$ATL_MANAGE/lib/common.sh" --

main() {
	if [[ $* =~ --help ]]; then usage "$@"; fi
	atl_event uninstall-pre "$@"
}

usage() {
	cat <<EOF
$*
Purpose: Deactivate the current ($ATL_VER) deployed instance of the app: uninstalls systemd, webserver, monitoring, cron scripts, etc.

Possible sub-commands:
EOF
	atl_event uninstall-pre -- --help
	exit
}

main "$@"

# vim: set foldmethod=marker formatoptions+=cro :
