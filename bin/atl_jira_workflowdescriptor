#!/bin/bash -eu
set -o pipefail

# shellcheck source=/opt/atl_manage/lib/common.sh
source "$ATL_MANAGE/lib/common.sh" --nolog

if [[ $# -eq 0 ]]; then
	echo >&2 "Purpose: prints the XML workflow descriptor for a Jira workflow, optionally with an xpath specifier"
	echo >&2 "Usage: atl_jira_workflowdescriptor <full workflow name> [--xpath=...]"
	exit 2
fi

wfname="$1"
shift

command -v xmllint >/dev/null || pkginstall libxml2-utils

echo "select descriptor from jiraworkflows where workflowname='$wfname';" | atl_psql -tAXq | xmllint -format -
